---
layout: default
title: Update Spreadsheet
---

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
<script type="text/javascript">

    var $resources = {
        team: 'https://docs.google.com/spreadsheets/d/1WAFPerZXyrVOTaWece5BTZYJPwfYVXC3GRpX8sBXzUU/edit?usp=sharing'
    };

    var header_maps = {
        team: {
            "Acknowledgement": "acknowledgement",
            "Department / Center / School": "affiliation",
            "Alumni?": "alumni",
            "What do you do now?": "alumni_current",
            "Short bio 1": "bio1",
            "Short bio 2": "bio2",
            "Short bio 3": "bio3",
            "Short bio 4": "bio4",
            "Display?": "display",
            "email": "email",
            "Image": "image",
            "Name": "name",
            "Position": "position",
            "Timestamp": "timestamp",
            "Year of joining": "year",
        }
    };

    var $org = 'gsaurabhr';
    var $repo = 'webdesign-test-template';
    var $branch = 'gh-pages';
    
    function getUrlVar(key){
        var result = new RegExp(key + "=([^&]*)", "i").exec(window.location.search);
        return result && unescape(result[1]) || "";
    }

    function getGDriveDlURL(url){
        return url; // No changes needed if the image URLs are already direct links.
    }

    var $GHToken = getUrlVar('ghtoken');

    var $yaml_store = "";

    function init() {
        $.each($resources, function(name, url) {
            function cb(results) {
                showInfo(results, name);
            }

            function map_header(header, index) {
                return header_maps[name][header];
            }

            function map_values(value, header) {
                if (header === "image") return getGDriveDlURL(value);
                if (header === "display" || header === "alumni") return parseInt(value);
                return value;
            }

            Papa.parse(url, {
                delimiter: ",",
                download: true,
                skipEmptyLines: 'greedy',
                dynamicTyping: true,
                header: true,
                transformHeader: map_header,
                transform: map_values,
                complete: cb
            });
        });
    };

    window.addEventListener('DOMContentLoaded', init);

    function showInfo(results, $resource) {
        var data = results.data;
        alert("Successfully processed " + data.length + " rows for " + $resource + "!");
         
        var $items = [];

        $.each(data, function(i, service) {
            var $p = {};
            $.each(service, function($key, $value) {
                $p[$key] = $value;
            });
            $items.push($p);
        });

        var $yaml_dump = jsyaml.dump($items);
        document.getElementById('source').value = $yaml_dump;

        var github = new Github({token: $GHToken, auth: "oauth"});
        var repo = github.getRepo($org, $repo);
        var $writepath = '_data/' + $resource + '.yaml';
        
        repo.write($branch, $writepath, $yaml_dump, 'Update ' + $resource, function(err) { console.log(err); });
    };
</script>
<textarea cols="10" rows="5" id="source" style="border: 1px solid #000; width: 100%; height: 500px;"></textarea>
